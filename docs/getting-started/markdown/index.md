$properties(base = ../../../, title = Winter Getting Started Guide)

<div class="heading">
	<h1 class="heading-title">Winter Getting Started Guide</h1> 
	<p class="heading-subtitle">Author: <a href="mailto:jeremy.kuhn@winterframework.io">Jeremy Kuhn</a></p> 
</div>

<div class="row align-items-stretch mt-5 mb-2">
	<div class="col-12 col-lg-6 mb-3">
		<div class="card shadow h-100">
			<div class="card-body p-lg-5">
		    	<h5 class="card-title">What you'll learn</h5>
				<p class="card-text">This guide provides insights into how to create a Winter application that exposes a simple <code>Hello World</code> HTTP endpoint.</p>
				<p class="card-text">We will guide you through creating a Maven project, creating the Winter module for the application, writing the HTTP endpoint, running the application and finally packaging the application into an optimized runtime image.</p>
			</div>
		</div>
	</div>
	<div class="col-12 col-lg-6 mb-3">
		<div class="card shadow h-100">
			<div class="card-body p-lg-5">
		    	<h5 class="card-title">What you'll need</h5>
		    	<ul>
		    		<li>A <em>Java™ Development Kit</em> (<a href="https://openjdk.java.net/install/">OpenJDK</a>) at least version 14.</li>
		    		<li>Apache <a href="https://maven.apache.org/">Maven</a> at least version 3.6.</li>
		    		<li>An <em>Integrated Development Environment</em> (IDE) such as <a href="https://www.eclipse.org/">Eclipse</a> or <a href="https://www.jetbrains.com/idea/">IDEA</a> although any text editor will do.</li>
		    	</ul>
			</div>
		</div>
	</div>
</div>

$doc

# Step 1: Create the Maven project

The creation of a Maven project setup with the Winter distribution should always be the first thing to do when developing a Winter component or application.

You can start by creating a regular Maven Java project using your IDE, the Maven [quickstart archetype](https://maven.apache.org/archetypes/maven-archetype-quickstart/) or manually using the text editor of your choice. Whatever you choose, you should end up with a project folder with the following file structure as generated by the Maven quickstart archetype:

```plaintext
├── pom.xml
└── src
    ├── main
    │   └── java
    │       └── com
    │           └── example
    │               └── helloworld
    │                   └── App.java
    └── test
        └── ...
```

You can now setup the `pom.xml` build descriptor with the Winter distribution by defining a `<parent/>` section pointing to `io.winterframework.dist:winter-parent:1.0.0` parent pom:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>io.winterframework.dist</groupId>
        <artifactId>winter-parent</artifactId>
        <version>1.0.0-SNAPSHOT</version>
    </parent>
    <groupId>com.example</groupId>
    <artifactId>helloworld</artifactId>
    <version>1.0-SNAPSHOT</version>

</project>
```

Then you must declare dependencies to Winter *boot* and *web* modules since you want to create a Web application. The *boot* module provides common services, it should be included in any Winter application. The *web* module provides the Web server and APIs for creating HTTP endpoints.

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>io.winterframework.dist</groupId>
        <artifactId>winter-parent</artifactId>
        <version>1.0.0-SNAPSHOT</version>
    </parent>
    <groupId>com.example</groupId>
    <artifactId>helloworld</artifactId>
    <version>1.0-SNAPSHOT</version>

    <dependencies>
        <dependency>
            <groupId>io.winterframework.mod</groupId>
            <artifactId>winter-boot</artifactId>
        </dependency>
        <dependency>
            <groupId>io.winterframework.mod</groupId>
            <artifactId>winter-web</artifactId>
        </dependency>
    </dependencies>
</project>
```

Congratulations! you have just created a new Winter project.

# Step 2: Create the Java module

A Winter component or application is a regular Java module annotated with `@io.winterframework.core.annotation.Module`. Open up the project in your IDE and create file `src/main/java/module-info.java`. In this module descriptor, you need to declare the modules required by your application, namely `io.winterframework.mod.boot` and `io.winterframework.mod.web` modules:

```java
@io.winterframework.core.annotation.Module
module com.example.helloworld {
    requires io.winterframework.mod.boot;
    requires io.winterframework.mod.web;
}
```

At compile time, the Winter compiler will assemble the *boot* and *web* modules together with your application module and generate a module class. This class contains all the IoC/DI logic required to bootstrap your application.

# Step 3: Add the code

In your IDE, open the `src/main/java/com/example/helloworld/App.java` 	and change the contents in order to create a Winter Web application:

```java
package com.example.helloworld;

import io.winterframework.core.annotation.Bean;
import io.winterframework.core.v1.Application;
import io.winterframework.mod.base.resource.MediaTypes;
import io.winterframework.mod.web.annotation.QueryParam;
import io.winterframework.mod.web.annotation.WebController;
import io.winterframework.mod.web.annotation.WebRoute;

import java.util.Optional;

@Bean
@WebController
public class App {

    @WebRoute( path = "/hello" )
    public String hello(@QueryParam Optional<String> name) {
        return String.format("Hello, %s!", name.orElse("world"));
    }

    public static void main(String[] args) {
        Application.run(new Helloworld.Builder());
    }
}
```

The `@Bean` annotation tells the Winter compiler that the `App` class is a bean participating in IoC/DI. The `@WebController` annotation indicates that the bean is also a Web controller defining Web routes. 

The `hello()` method annotated with `@WebRoute( path = "/hello")` defines a Web route which is invoked when a HTTP request is sent to `http://localhost:8080/hello` location. The `@QueryParam` annotation indicates that the route accept a query parameter named after the annotated method parameter `name`. This query parameter is optional since the method parameter is of type `Optional<String>`.

Finally, the application is started in the `main()` method using the `Helloworld` module class generated by the Winter compiler.

> The Winter compiler generates module class `com.example.helloworld.Helloworld` when the project is compiled (eg. `mvn compile`), you might want to configure your IDE to make the generated code visible and get rid of the compilation error reported in the `main()` method by adding folder `target/generated-sources/annotations` to the project build path. In Eclipse, you can do that in the project properties > Source > Add Folder...

# Step 4: Run the application

You are now ready to build and run the application, open a terminal, go to the project folder and simply execute the following command:

```plaintext
$ mvn winter:run
```

You should see an output similar to the following:

```plaintext
[INFO] --- winter-maven-plugin:1.0.0-SNAPSHOT:run (default-cli) @ helloworld ---
[INFO] Running project: com.example.helloworld@1.0-SNAPSHOT...
ERROR StatusLogger Log4j2 could not find a logging implementation. Please add log4j-core to the classpath. Using SimpleLogger to log to the console...
INFO Application Winter is starting...


     ╔════════════════════════════════════════════════════════════════════════════════════════════╗
     ║                       , ~~ ,                                                               ║
     ║                   , '   /\   ' ,                 _                                         ║
     ║                  , __   \/   __ ,       _     _ (_)        _                               ║
     ║                 ,  \_\_\/\/_/_/  ,     | | _ | | _   ___  | |_   ___   __                  ║
     ║                 ,    _\_\/_/_    ,     | |/_\| || | / _ \ | __| / _ \ / _|                 ║
     ║                 ,   __\_/\_\__   ,     \  / \  /| || | | || |_ |  __/| |                   ║
     ║                  , /_/ /\/\ \_\ ,       \/   \/ |_||_| |_| \__| \___||_|                   ║
     ║                   ,     /\     ,                                                           ║
     ║                     ,   \/   ,                        -- 1.0.2-SNAPSHOT --                 ║
     ║                       ' -- '                                                               ║
     ╠════════════════════════════════════════════════════════════════════════════════════════════╣
     ║ Java runtime        : OpenJDK Runtime Environment                                          ║
     ║ Java version        : 16+36-2231                                                           ║
     ║ Java home           : /home/jkuhn/Devel/jdk/jdk-16                                         ║
     ║                                                                                            ║
     ║ Application module  : com.example.helloworld                                               ║
     ║ Application version : 1.0-SNAPSHOT                                                         ║
     ║ Application class   : com.example.helloworld.App                                           ║
     ║                                                                                            ║
     ║ Modules             :                                                                      ║
     ║  * com.example.helloworld@1.0-SNAPSHOT                                                     ║
     ║  * ...                                                                                     ║
     ╚════════════════════════════════════════════════════════════════════════════════════════════╝


INFO Helloworld Starting Module com.example.helloworld...
INFO Boot Starting Module io.winterframework.mod.boot...
INFO Boot Module io.winterframework.mod.boot started in 246ms
INFO Web Starting Module io.winterframework.mod.web...
INFO Server Starting Module io.winterframework.mod.http.server...
INFO Base Starting Module io.winterframework.mod.http.base...
INFO Base Module io.winterframework.mod.http.base started in 5ms
INFO HttpServer HTTP Server (nio) listening on http://0.0.0.0:8080
INFO Server Module io.winterframework.mod.http.server started in 99ms
INFO Web Module io.winterframework.mod.web started in 99ms
INFO Helloworld Module com.example.helloworld started in 348ms
INFO Application Application com.example.helloworld started in 443ms
```

A Web server has been started listening on port 8080, you can now test the `/hello` endpoint:

Using `curl` in a terminal:

```plaintext
$ curl -i http://localhost:8080/hello
HTTP/1.1 200 OK
content-length: 13

Hello, world!
```

Using a Web browser pointing to `http://localhost:8080/hello?name=John`:

<img class="shadow" src="img/hello_browser.png" style="display: block; margin: 2em auto;"/>

# Step 5: Package and deploy the application

You can package the application into a native platform dependent image containing a Java runtime with the exact dependencies needed by the application and deploy it to your local Maven repository or eventually to a remote repository:

```plaintext
$ mvn winter:build-app install
```

> Note that if you are using a JDK<16, you'll need to explicitly add the `jdk.incubator.jpackage` module in MAVEN_OPTS: `MAVEN_OPTS="--add-modules jdk.incubator.jpackage"`

Then you can install the application on any compatible platform by downloading and unpacking the application image using Maven dependency plugin:

```plaintext
$ mvn dependency:unpack -Dartifact=com.example:helloworld:1.0-SNAPSHOT:zip:application_linux_amd64 -DoutputDirectory=./
```

You can run it using a native command:

```plaintext
$ ./helloworld-1.0-SNAPSHOT/bin/helloworld
```